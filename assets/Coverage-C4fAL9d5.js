import{r,j as t,t as O,p as U,g as X,e as _,d as q,a as J}from"./index-XIR_oFmk.js";function $(){return{line1:"1 57166U 23091A   25030.50000000  .00000100  00000-0  10000-3 0  9999",line2:"2 57166  97.7500  90.0000 0001000   0.0000   0.0000 14.80000000 10000"}}function Q(b,u,w,k,W){let x;try{x=O(b,u)}catch{return{track:[],swath:[]}}const R=new Date,g=[],L=Math.floor(w*60/k);for(let p=0;p<=L;p++){const T=new Date(R.getTime()+p*k*1e3),i=U(x,T);if(!i.position)continue;const E=X(T),S=_(i.position,E),M=q(S.latitude),N=J(S.longitude),C=S.height;g.push({lat:M,lon:N,alt:C,time:T})}return{track:g}}function A(b,u){return u/2/b*(180/Math.PI)}function Z(){const b=r.useRef(null),[u,w]=r.useState($().line1),[k,W]=r.useState($().line2),[x,R]=r.useState(1440),[g,L]=r.useState(60),[p,T]=r.useState(30),[i,E]=r.useState(null),[S,M]=r.useState("57166"),[N,C]=r.useState(!1),[h,I]=r.useState(null),[v,F]=r.useState(55),K=async()=>{C(!0);try{const s=await fetch(`/eo_services/api/spacetrack/tle/${S}`);if(s.ok){const n=(await s.json()).tle.trim().split(`
`).filter(d=>d.trim()),l=n[n.length-2],c=n[n.length-1];l?.startsWith("1 ")&&c?.startsWith("2 ")&&(w(l),W(c))}}catch(s){console.error(s)}C(!1)},Y=r.useCallback(()=>{const s=Q(u,k,x,p);if(E(s.track),s.track.length>1){const n=s.track.filter(d=>Math.abs(d.lat-v)<2),l=new Set,c=A(s.track[0]?.alt||500,g);n.forEach(d=>{for(let f=-c;f<=c;f+=.5)l.add(Math.round((d.lon+f+360)%360))}),I({percent:(l.size/360*100).toFixed(1),passCount:n.length,latBand:v})}},[u,k,x,p,g,v]),B=r.useCallback(()=>{const s=b.current;if(!s||!i)return;const e=s.getContext("2d"),n=s.width,l=s.height;e.fillStyle="#0d1b2a",e.fillRect(0,0,n,l),e.strokeStyle="#1b2838",e.lineWidth=.5;for(let a=-80;a<=80;a+=20){const o=l/2-a/180*l;e.beginPath(),e.moveTo(0,o),e.lineTo(n,o),e.stroke()}for(let a=-160;a<=160;a+=40){const o=n/2+a/360*n;e.beginPath(),e.moveTo(o,0),e.lineTo(o,l),e.stroke()}e.strokeStyle="#ffff0033",e.lineWidth=1,e.beginPath(),e.moveTo(0,l/2),e.lineTo(n,l/2),e.stroke(),e.fillStyle="#ffffff44",e.font="10px sans-serif";for(let a=-80;a<=80;a+=20){const o=l/2-a/180*l;e.fillText(`${a}°`,4,o-2)}for(let a=-160;a<=160;a+=40){const o=n/2+a/360*n;e.fillText(`${a}°`,o+2,l-4)}const c=l/2-(v+2)/180*l,d=l/2-(v-2)/180*l;if(e.fillStyle="#e67e2220",e.fillRect(0,c,n,d-c),e.strokeStyle="#e67e2266",e.lineWidth=1,e.beginPath(),e.moveTo(0,(c+d)/2),e.lineTo(n,(c+d)/2),e.stroke(),i.length>1){const a=A(i[0]?.alt||500,g);e.fillStyle="#4ecdc433",i.forEach(o=>{const j=n/2+o.lon/360*n,P=l/2-o.lat/180*l,z=a*2/180*l;e.fillRect(j-1,P-z/2,2,z)})}e.strokeStyle="#4ecdc4",e.lineWidth=1.5;let f=null,D=null;if(i.forEach(a=>{const o=n/2+a.lon/360*n,j=l/2-a.lat/180*l;f!==null&&Math.abs(o-f)<n/2&&(e.beginPath(),e.moveTo(f,D),e.lineTo(o,j),e.stroke()),f=o,D=j}),i.length>0){const a=i[0],o=i[i.length-1];[[a,"#00ff88","▶"],[o,"#ff4444","■"]].forEach(([j,P,z])=>{const G=n/2+j.lon/360*n,H=l/2-j.lat/180*l;e.beginPath(),e.arc(G,H,4,0,2*Math.PI),e.fillStyle=P,e.fill()})}h&&(e.fillStyle="#00000088",e.fillRect(n-200,8,192,60),e.fillStyle="#ffffff",e.font="12px sans-serif",e.fillText(`Широта: ${h.latBand}°`,n-190,26),e.fillText(`Покрытие: ${h.percent}%`,n-190,42),e.fillText(`Точек в полосе: ${h.passCount}`,n-190,58))},[i,h,v]);r.useEffect(()=>{B()},[B]);const m="w-full px-2 py-1.5 border border-gray-300 rounded text-sm",y="text-xs text-gray-500 mb-0.5";return t.jsxs("div",{className:"page-content",style:{maxWidth:1100},children:[t.jsxs("div",{className:"service-header",children:[t.jsxs("svg",{width:"28",height:"28",viewBox:"0 0 36 36",fill:"none",children:[t.jsx("rect",{x:"4",y:"8",width:"28",height:"20",rx:"2.5",stroke:"var(--accent)",strokeWidth:"1.5"}),t.jsx("path",{d:"M4 18h28M18 8v20",strokeDasharray:"2 2.5",stroke:"var(--accent)",strokeWidth:"1",opacity:".4"}),t.jsx("path",{d:"M9 14l5 5-3 3.5 7-1.5 5 2.5",stroke:"var(--accent)",strokeWidth:"1.8",strokeLinecap:"round",strokeLinejoin:"round"})]}),t.jsx("h1",{children:"Расчёт покрытия"})]}),t.jsxs("div",{style:{display:"flex",gap:16,flexWrap:"wrap"},children:[t.jsxs("div",{className:"card",style:{flex:"0 0 280px"},children:[t.jsx("h3",{style:{fontWeight:600,marginBottom:12,fontSize:14},children:"Параметры"}),t.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:8},children:[t.jsxs("div",{children:[t.jsx("div",{className:y,children:"NORAD ID"}),t.jsxs("div",{style:{display:"flex",gap:4},children:[t.jsx("input",{className:m,value:S,onChange:s=>M(s.target.value),placeholder:"57166"}),t.jsx("button",{onClick:K,disabled:N,style:{padding:"4px 12px",background:"var(--accent)",color:"white",border:"none",borderRadius:6,cursor:"pointer",fontSize:12,whiteSpace:"nowrap"},children:N?"...":"Загрузить"})]})]}),t.jsxs("div",{children:[t.jsx("div",{className:y,children:"TLE Line 1"}),t.jsx("input",{className:m,value:u,onChange:s=>w(s.target.value),style:{fontSize:10,fontFamily:"monospace"}})]}),t.jsxs("div",{children:[t.jsx("div",{className:y,children:"TLE Line 2"}),t.jsx("input",{className:m,value:k,onChange:s=>W(s.target.value),style:{fontSize:10,fontFamily:"monospace"}})]}),t.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:8},children:[t.jsxs("div",{children:[t.jsx("div",{className:y,children:"Длительность (мин)"}),t.jsx("input",{type:"number",className:m,value:x,onChange:s=>R(+s.target.value)})]}),t.jsxs("div",{children:[t.jsx("div",{className:y,children:"Шаг (сек)"}),t.jsx("input",{type:"number",className:m,value:p,onChange:s=>T(+s.target.value)})]}),t.jsxs("div",{children:[t.jsx("div",{className:y,children:"Полоса захвата (км)"}),t.jsx("input",{type:"number",className:m,value:g,onChange:s=>L(+s.target.value)})]}),t.jsxs("div",{children:[t.jsx("div",{className:y,children:"Широта анализа (°)"}),t.jsx("input",{type:"number",className:m,value:v,onChange:s=>F(+s.target.value)})]})]}),t.jsx("button",{onClick:Y,style:{padding:"10px",background:"#e67e22",color:"white",border:"none",borderRadius:8,cursor:"pointer",fontWeight:600,fontSize:14},children:"Рассчитать"}),h&&t.jsxs("div",{style:{background:"#f0f9ff",padding:12,borderRadius:8},children:[t.jsx("div",{style:{fontSize:13,fontWeight:600,marginBottom:4},children:"Результат"}),t.jsxs("div",{style:{fontSize:12},children:["Покрытие на ",h.latBand,"°: ",t.jsxs("b",{children:[h.percent,"%"]})]}),t.jsxs("div",{style:{fontSize:12,color:"#666"},children:[i?.length||0," точек трассы, ",(x/60).toFixed(1)," ч"]})]})]})]}),t.jsx("div",{className:"card",style:{flex:1,minWidth:500,padding:8},children:t.jsx("canvas",{ref:b,width:800,height:400,style:{width:"100%",height:"auto",borderRadius:8}})})]})]})}export{Z as default};
