import{r as i,j as e,t as R,p as B,g as I,b as F,e as G,a as U,d as $,c as X,f as E}from"./index-kb2XKiuk.js";function L(){return{line1:"1 25544U 98067A   25030.50000000  .00010000  00000-0  10000-3 0  9999",line2:"2 25544  51.6400 200.0000 0007000 300.0000  60.0000 15.50000000 10000"}}function _(n,h,p){const o=B(n,p);if(!o.position)return null;const u=I(p),j=F(o.position,u),d=X(h,j),r=G(o.position,u);return{elevation:d.elevation*180/Math.PI,azimuth:d.azimuth*180/Math.PI,range:d.rangeSat,alt:r.height,lat:$(r.latitude),lon:U(r.longitude)}}function q(n,h,p,o,u,j,d){let r;try{r=R(n,h)}catch{return[]}const v={longitude:E(o),latitude:E(p),height:u/1e3},b=[],y=new Date,z=new Date(y.getTime()+j*864e5),S=30;let g=!1,s=null,m=0;for(let a=y.getTime();a<z.getTime();a+=S*1e3){const f=new Date(a),l=_(r,v,f);l&&(l.elevation>0?(g||(g=!0,s={aos:new Date(a),aosAz:l.azimuth,maxEl:0,tca:null,tcaAz:0,los:null,losAz:0},m=0),l.elevation>m&&(m=l.elevation,s.maxEl=m,s.tca=new Date(a),s.tcaAz=l.azimuth,s.tcaRange=l.range)):g&&(g=!1,s.los=new Date(a),s.losAz=l.azimuth,s.duration=(s.los-s.aos)/1e3,s.maxEl>=d&&b.push(s)))}return b}function N(n){return n?n.toLocaleString("ru-RU",{day:"2-digit",month:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit"}):"-"}function C(n){return n!==void 0?n.toFixed(1)+"°":"-"}function W(n){return["С","ССВ","СВ","ВСВ","В","ВЮВ","ЮВ","ЮЮВ","Ю","ЮЮЗ","ЮЗ","ЗЮЗ","З","ЗСЗ","СЗ","ССЗ"][Math.round(n/22.5)%16]}function J(){const[n,h]=i.useState(L().line1),[p,o]=i.useState(L().line2),[u,j]=i.useState(55.75),[d,r]=i.useState(37.62),[v,b]=i.useState(200),[y,z]=i.useState(3),[S,g]=i.useState(5),[s,m]=i.useState(null),[a,f]=i.useState(!1),[l,D]=i.useState("25544"),O=async()=>{f(!0);try{const t=await fetch(`/eo_services/api/spacetrack/tle/${l}`);if(t.ok){const A=(await t.json()).tle.trim().split(`
`).filter(P=>P.trim()),w=A[A.length-2],k=A[A.length-1];w?.startsWith("1 ")&&k?.startsWith("2 ")&&(h(w),o(k))}}catch(t){console.error(t)}f(!1)},M=()=>{f(!0),setTimeout(()=>{const t=q(n,p,u,d,v,y,S);m(t),f(!1)},50)},c="w-full px-2 py-1.5 border border-gray-300 rounded text-sm",x="text-xs text-gray-500 mb-0.5";return e.jsxs("div",{className:"page-content",style:{maxWidth:900},children:[e.jsxs("div",{className:"service-header",children:[e.jsxs("svg",{width:"28",height:"28",viewBox:"0 0 36 36",fill:"none",children:[e.jsx("circle",{cx:"18",cy:"22",r:"10",stroke:"var(--accent)",strokeWidth:"1.5"}),e.jsx("path",{d:"M8 22a10 10 0 0 1 20 0",fill:"none",stroke:"var(--accent)",strokeWidth:"1",opacity:".4"}),e.jsx("line",{x1:"18",y1:"22",x2:"25",y2:"15",stroke:"var(--accent)",strokeWidth:"1.5"}),e.jsx("circle",{cx:"18",cy:"8",r:"2.5",fill:"var(--accent)",fillOpacity:".2",stroke:"var(--accent)",strokeWidth:"1.2"})]}),e.jsx("h1",{children:"Прогноз пролётов"})]}),e.jsxs("div",{style:{display:"flex",gap:16,flexWrap:"wrap"},children:[e.jsxs("div",{className:"card",style:{flex:"0 0 300px"},children:[e.jsx("h3",{style:{fontWeight:600,marginBottom:12,fontSize:14},children:"Параметры"}),e.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:8},children:[e.jsxs("div",{children:[e.jsx("div",{className:x,children:"NORAD ID"}),e.jsxs("div",{style:{display:"flex",gap:4},children:[e.jsx("input",{className:c,value:l,onChange:t=>D(t.target.value),placeholder:"25544"}),e.jsx("button",{onClick:O,disabled:a,style:{padding:"4px 12px",background:"var(--accent)",color:"white",border:"none",borderRadius:6,cursor:"pointer",fontSize:12,whiteSpace:"nowrap"},children:a?"...":"TLE"})]})]}),e.jsxs("div",{children:[e.jsx("div",{className:x,children:"TLE Line 1"}),e.jsx("input",{className:c,value:n,onChange:t=>h(t.target.value),style:{fontSize:10,fontFamily:"monospace"}})]}),e.jsxs("div",{children:[e.jsx("div",{className:x,children:"TLE Line 2"}),e.jsx("input",{className:c,value:p,onChange:t=>o(t.target.value),style:{fontSize:10,fontFamily:"monospace"}})]}),e.jsxs("div",{style:{borderTop:"1px solid #e5e7eb",paddingTop:8,marginTop:4},children:[e.jsx("div",{style:{fontWeight:600,fontSize:13,marginBottom:8},children:"Наблюдатель"}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:8},children:[e.jsxs("div",{children:[e.jsx("div",{className:x,children:"Широта (°)"}),e.jsx("input",{type:"number",step:"0.01",className:c,value:u,onChange:t=>j(+t.target.value)})]}),e.jsxs("div",{children:[e.jsx("div",{className:x,children:"Долгота (°)"}),e.jsx("input",{type:"number",step:"0.01",className:c,value:d,onChange:t=>r(+t.target.value)})]}),e.jsxs("div",{children:[e.jsx("div",{className:x,children:"Высота (м)"}),e.jsx("input",{type:"number",className:c,value:v,onChange:t=>b(+t.target.value)})]}),e.jsxs("div",{children:[e.jsx("div",{className:x,children:"Дней вперёд"}),e.jsx("input",{type:"number",className:c,value:y,onChange:t=>z(+t.target.value)})]})]}),e.jsxs("div",{style:{marginTop:8},children:[e.jsx("div",{className:x,children:"Мин. угол возвышения (°)"}),e.jsx("input",{type:"number",className:c,value:S,onChange:t=>g(+t.target.value)})]})]}),e.jsx("button",{onClick:M,disabled:a,style:{padding:"10px",background:"#e74c3c",color:"white",border:"none",borderRadius:8,cursor:"pointer",fontWeight:600,fontSize:14,opacity:a?.6:1},children:a?"Расчёт...":"Рассчитать пролёты"})]})]}),e.jsxs("div",{className:"card",style:{flex:1,minWidth:400},children:[e.jsxs("h3",{style:{fontWeight:600,marginBottom:12,fontSize:14},children:["Пролёты ",s?`(${s.length})`:""]}),!s&&e.jsx("div",{style:{color:"#999",textAlign:"center",padding:40},children:"Нажмите «Рассчитать» для получения прогноза"}),s&&s.length===0&&e.jsx("div",{style:{color:"#999",textAlign:"center",padding:40},children:"Пролётов не найдено"}),s&&s.length>0&&e.jsxs("div",{style:{overflowX:"auto"},children:[e.jsxs("table",{style:{width:"100%",borderCollapse:"collapse",fontSize:12},children:[e.jsx("thead",{children:e.jsxs("tr",{style:{borderBottom:"2px solid #e5e7eb",textAlign:"left"},children:[e.jsx("th",{style:{padding:"6px 4px"},children:"#"}),e.jsx("th",{style:{padding:"6px 4px"},children:"AOS"}),e.jsx("th",{style:{padding:"6px 4px"},children:"Az"}),e.jsx("th",{style:{padding:"6px 4px"},children:"TCA"}),e.jsx("th",{style:{padding:"6px 4px"},children:"Max El"}),e.jsx("th",{style:{padding:"6px 4px"},children:"LOS"}),e.jsx("th",{style:{padding:"6px 4px"},children:"Az"}),e.jsx("th",{style:{padding:"6px 4px"},children:"Длит."})]})}),e.jsx("tbody",{children:s.map((t,T)=>e.jsxs("tr",{style:{borderBottom:"1px solid #f0f0f0"},children:[e.jsx("td",{style:{padding:"6px 4px",color:"#999"},children:T+1}),e.jsx("td",{style:{padding:"6px 4px"},children:N(t.aos)}),e.jsxs("td",{style:{padding:"6px 4px",color:"#666"},children:[C(t.aosAz)," ",W(t.aosAz)]}),e.jsx("td",{style:{padding:"6px 4px"},children:N(t.tca)}),e.jsxs("td",{style:{padding:"6px 4px",fontWeight:600,color:t.maxEl>45?"#27ae60":t.maxEl>20?"#e67e22":"#e74c3c"},children:[t.maxEl.toFixed(1),"°"]}),e.jsx("td",{style:{padding:"6px 4px"},children:N(t.los)}),e.jsxs("td",{style:{padding:"6px 4px",color:"#666"},children:[C(t.losAz)," ",W(t.losAz)]}),e.jsxs("td",{style:{padding:"6px 4px"},children:[Math.floor(t.duration/60),":",String(Math.floor(t.duration%60)).padStart(2,"0")]})]},T))})]}),e.jsxs("div",{style:{marginTop:12,fontSize:11,color:"#999"},children:["AOS — появление над горизонтом, TCA — кульминация, LOS — заход. Цвет элевации: зелёный ",">"," 45°, оранжевый ",">"," 20°, красный — остальные."]})]})]})]})]})}export{J as default};
